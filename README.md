# abtest_system
Тестовый проект - реализация системы АБ-тестов.
Помимо самой системы реализованы упрощённые модули: Сейвы, Пользовательские данные, Синхронизация времени, Слой UI
Сцена: Menu.

Время затраченное:
1. Сейвы, Пользовательские данные, Синхронизация времени - 5 ч.
2. AbTestSystem, AbTest, Condition - 4 ч.
3. Десериализация конфига abtest_config.json - 2 ч.
4. Слой UI для тестирования - 4 ч.
5. Отладка, тестирование и правка мелких багов - 2 ч.

Использованные плагины: Newtonsoft Json и TMPro.

Загрузка конфига происходит из локального файла, конфиг можно грузить с cdn заменив ссылку:
> AbTestSystem._abTestConfigUrl = $"file:///{Application.streamingAssetsPath}/abtest_config.json";

Аб-тесты создаются и обновляются из конфига.
У каждого аб-теста есть уникальный Id и Version, опираясь на них, определяем нужно ли обновлять тест.
Парамерты из аб тестов можно вытаскивать по имени параметра и его типу, либо по Id аб-теста можно получить всю текущую когорту значений аб-теста.
Аб-тесты поддерживают наличие нескольких параметров в когортах.
Условиями запуска и завершения аб-тестов могут выступать ДатаВремя или простое значение(int, double, bool, string).
В перспективе можно сделать реализацию более комплексных условий, например, логическое ИЛИ/условия на основе комплексных переменных(class, struct). 
Для этого необходимо будет написать новую реализацию BaseCondition и доработать парсинг конфига.
Также, в теории, можно реализовать передачу через конфиг комплексных переменных(class, struct), что так же потребует доработки парсинга.
При наличии одинаковых параметров в рамках нескольких абтестов берётся параметр с большим приоритетом: Priority.

Реализация собственного парсинга конфига обусловлено упрощение состава конфига, для удобного оперирования конфигами аналитиков, qa и гд.
Стандартный десериализатор Newtonsoft Json добавляет в конфиг дополнительные поля, например, типы классов, для однозначной десериализации, что существенно усложняет понимание и оперирования.

Условия:
>{
	"TypeCondition": "Value", //Тип - значение
	"Key": "current_level", //Ключ параметра
	"Value": 10, //Значение параметра
	"Condition": "MoreOrEqual" // Знак условия
},
{
	"TypeCondition": "Time", //Тип - время
	"Time": "2022-12-30T00:00:00Z", //Значение - формат ГГГГ-ММ-ДДTЧЧ:ММ:ССZ
	"IsGlobal": true, //Флаг - требуется ли верификация времени по серверу или можно опираться на локальное время
	"Condition": "LessOrEqual" // Знак условия
}

Возможные значения Condition:
>Less - <,
LessOrEqual - <=,
Equal - ==,
NonEqual - !=,
MoreOrEqual - >=,
More - >,
Any - Всегда,
Never - Никогда

Когорта пользователю при старте аб-теста присваивается на основе deviceUniqueIdentifier и последовательности простых чисел [3,...,53]. 
Данный алгоритм обеспечивает псевдослучайное распределение пользователей в рамках аб-теста. В такой реализации пользователь всегда будет получать одно и тоже значение в рамках одного аб-теста и одного устройства, что помогает избежать неприятных ситуаций, например, когда у юзера меняется цена товаров в магазине из-за того что она переустановил игру.
При этом такое распределение полностью соответствует равномерному.перспективные 

Слой UI реализован для возможности симуляции работы и тестирования AbTestSystem. Возможно некоторые решения могут быть неоптимальные


Возможные улучшения проекта:
- Реализация сигнальной шины, для уменьшения связности;
- Реализация общего контейнера для передачи модулей проекта друг другу и избавления от множественного поиска FindObjectOfType();
- Переработка апдейта аб-тестов на основе изменения геймплейного стейта или изменения ключевых параметров: уровень, количество валюты;
- 